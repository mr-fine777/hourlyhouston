<!-- Article page client logic: fetch a post by title query and populate the page -->
<!DOCTYPE HTML>
<html lang="en">
<head>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
	<base href="/">
	<link rel="stylesheet" href="/styles.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <title id="page-title">Hourly Houston</title>
    <!-- SEO/meta placeholders (will be populated dynamically when the article loads) -->
    <meta id="meta-desc" name="description" content="Hourly Houston article">
    <meta id="meta-ogtitle" property="og:title" content="Hourly Houston">
    <meta id="meta-ogdesc" property="og:description" content="Hourly Houston article">
    <meta id="meta-ogimage" property="og:image" content="">
	<meta id="meta-ogurl" property="og:url" content="https://hourlyhouston.vercel.app/">
	<meta id="meta-ogsite" property="og:site_name" content="Hourly Houston">
	<meta id="meta-twitter-title" name="twitter:title" content="Hourly Houston">
	<meta id="meta-twitter-desc" name="twitter:description" content="Hourly Houston article">
	<meta id="meta-twitter-image" name="twitter:image" content="">
	<meta id="meta-name-title" name="title" content="Hourly Houston">
    <meta id="meta-twitter" name="twitter:card" content="summary_large_image">

    <!-- Injection templates: place small HTML widgets or scripts here using type="text/x-inject" and id matching the slot ids below.
	    Example safe usage (paste into <head>):
	    <script type="text/x-inject" id="inject-slot-1">&lt;div class="my-widget"&gt;Your widget HTML here&lt;/div&gt;</script>
	    To execute JS instead of inserting HTML, add data-exec="true" and the runner will create and execute a real <script> element in the matching slot.
    -->
    <!-- you can add your inject templates here in the head; see ids: inject-slot-1, inject-slot-2, inject-slot-3 -->
	<meta name="description" content="Get updated content for Houston Hourly!">
	<meta name="author" content="Hourly Houston">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="UTF-8">
	<link rel="icon" href="img/ico.png" media="(prefers-color-scheme: light)">
	<link rel="icon" href="img/icoW.png" media="(prefers-color-scheme: dark)">
</head>
<body>
	<!-- Mobile menu toggle: button-driven accessible drawer (replaces checkbox pattern) -->
<header class="site-header">
	<div class="header-left">
		<a href="/" class="home-link">
			<img src="img/icoW.png" alt="Hourly Houston logo" class="logo">
			<h2 class="site-title">Hourly Houston</h2>
		</a>
	</div>
	<div class="header-right">
		<a href="/about.html" class="cta-link" aria-label="About">
			<button class="btn">About</button>
		</a>
		<form class="search-form" action="/search.html" method="get" role="search">
			<label for="q" class="visually-hidden">Search articles</label>
			<input id="q" name="q" type="search" placeholder="Search articles" aria-label="Search articles">
			<button type="submit" aria-label="Submit search"><i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i></button>
		</form>
		<button class="hamburger" aria-label="Open menu" aria-controls="drawer" aria-expanded="false" title="Open menu"><span class="bar"></span></button>
	</div>
</header>
<!-- clickable backdrop: clicking will close the drawer -->
<div class="backdrop" aria-hidden="true"></div>
<div class="hero-container">
<div class="hero-body">
		
        	<img id="hero-img" tabindex="-1" aria-live="polite" alt="" loading="lazy" decoding="async" style="display:none; width:100%; height:auto; object-fit:cover;" />
		
	<div class="article-section">
	<h1 id="title">Article Title</h1>
	<h2 id="date">Article scrapedAt</h2>
	<p id="body">Article Body</p>
	</div>
	
	</div>
	<div class="hero-side" id="drawer" role="dialog" aria-modal="true" aria-hidden="true">
		<button class="drawer-close" aria-label="Close menu">×</button>
	<h2 id="timer" style="font-size: 32px; text-align: center; color: white;">00:00xm</h2>
    <div class="weather-card">
	<h1>Downtown Houston</h1>
	<h2 id="77002"></h2>
	</div>
	<div class="weather-card">
	<h1>Midtown</h1>
	<h2 id="77006"></h2>
	</div>
	<div class="weather-card">
	<h1>The Woodlands</h1>
	<h2 id="77380"></h2>
	</div>
	<div class="weather-card">
	<h1>Spring</h1>
	<h2 id="77373"></h2>
	</div>
	<div class="weather-card">
	<h1>Kingwood</h1>
	<h2 id="77339"></h2>
	</div>
	<div class="weather-card">
	<h1>Memorial</h1>
	<h2 id="77024"></h2>
	</div>
	<div class="weather-card">
	<h1>Katy</h1>
	<h2 id="77493"></h2>
	</div>
	<div class="weather-card">
	<h1>Pearland</h1>
	<h2 id="77584"></h2>
	</div>
	<div class="weather-card">
	<h1>Sugar Land</h1>
	<h2 id="77478"></h2>
	</div>
	<div class="weather-card">
	<h1>Pasadena</h1>
	<h2 id="77502"></h2>
	</div>
	<div class="weather-card">
	<h1>Baytown</h1>
	<h2 id="77520"></h2>
	</div>
	<div class="weather-card">
	<h1>Humble</h1>
	<h2 id="77338"></h2>
	</div>
	<div class="weather-card">
	<h1>Galveston</h1>
	<h2 id="77550"></h2>
	</div>
	<div class="weather-card">
	<h1>La Porte</h1>
	<h2 id="77571"></h2>
	</div>
	<div class="weather-card">
	<h1>Conroe</h1>
	<h2 id="77301"></h2>
	</div>
	<div class="weather-card">
	<h1>Tomball</h1>
	<h2 id="77375"></h2>
	</div>
	<div class="weather-card">
	<h1>Cypress</h1>
	<h2 id="77429"></h2>
	</div>
	<div class="weather-card">
	<h1>Missouri City</h1>
	<h2 id="77459"></h2>
	</div>
	<div class="weather-card">
	<h1>Stafford</h1>
	<h2 id="77477"></h2>
	</div>
	<div class="weather-card">
	<h1>Seabrook</h1>
	<h2 id="77586"></h2>
	</div>
	<div class="weather-card">
	<h1>League City</h1>
	<h2 id="77573"></h2>
	</div>
	<div class="weather-card">
	<h1>Huffman</h1>
	<h2 id="77336"></h2>
	</div>
	<div class="weather-card">
	<h1>Atascocita</h1>
	<h2 id="77346"></h2>
	</div>
	<div class="weather-card">
	<h1>Briarforest</h1>
	<h2 id="77077"></h2>
	</div>
	<div class="weather-card">
	<h1>Channelview</h1>
	<h2 id="77530"></h2>
	</div>
	
	</div>
  </div>
</div>
<script>
// Drawer behavior, focus management, ESC handling, swipe-to-close and backdrop handling
;(function(){
	const drawer = document.getElementById('drawer');
	const backdrop = document.querySelector('.backdrop');
	const openBtn = document.querySelector('.hamburger');
	const closeBtn = document.querySelector('.drawer-close');
	if(!drawer || !openBtn) return;

	let lastFocused = null;

	function isSmallViewport(){ return window.matchMedia && window.matchMedia('(max-width: 520px)').matches; }

	function lockScroll(){
		if(!isSmallViewport()) return;
		const scrollY = window.scrollY || document.documentElement.scrollTop || 0;
		document.body.dataset.scrollY = String(scrollY);
		document.body.style.position = 'fixed';
		document.body.style.top = `-${scrollY}px`;
		document.body.style.left = '0';
		document.body.style.right = '0';
		document.body.style.width = '100%';
		document.body.classList.add('no-scroll');
	}

	function unlockScroll(){
		const prev = document.body.dataset.scrollY ? parseInt(document.body.dataset.scrollY, 10) : 0;
		document.body.style.position = '';
		document.body.style.top = '';
		document.body.style.left = '';
		document.body.style.right = '';
		document.body.style.width = '';
		delete document.body.dataset.scrollY;
		document.body.classList.remove('no-scroll');
		window.scrollTo(0, prev);
	}

	function openDrawer(){
		lastFocused = document.activeElement;
		document.body.classList.add('menu-open');
		drawer.setAttribute('aria-hidden', 'false');
		openBtn.setAttribute('aria-expanded', 'true');
		if(backdrop) backdrop.setAttribute('aria-hidden', 'false');
		lockScroll();
		// move focus to the first focusable element inside the drawer (close button)
		const focusable = drawer.querySelector('button, [href], input, textarea, select, [tabindex]:not([tabindex="-1"])');
		(focusable || drawer).focus();
		// trap focus
		document.addEventListener('focus', trapFocus, true);
		document.addEventListener('keydown', onKeyDown, true);
	}

	function closeDrawer(){
		document.body.classList.remove('menu-open');
		drawer.setAttribute('aria-hidden', 'true');
		openBtn.setAttribute('aria-expanded', 'false');
		if(backdrop) backdrop.setAttribute('aria-hidden', 'true');
		unlockScroll();
		document.removeEventListener('focus', trapFocus, true);
		document.removeEventListener('keydown', onKeyDown, true);
		if(lastFocused && typeof lastFocused.focus === 'function') lastFocused.focus();
	}

	function onKeyDown(e){
		if(e.key === 'Escape') { closeDrawer(); }
		if(e.key === 'Tab') { maintainFocus(e); }
	}

	function trapFocus(e){
		if(!drawer.contains(e.target) && document.body.classList.contains('menu-open')){
			e.stopPropagation();
			drawer.querySelector('button, [href], input, textarea, select')?.focus();
		}
	}

	function maintainFocus(e){
		const focusable = Array.from(drawer.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])')).filter(Boolean);
		if(!focusable.length) return;
		const first = focusable[0];
		const last = focusable[focusable.length - 1];
		if(e.shiftKey && document.activeElement === first){
			e.preventDefault(); last.focus();
		} else if(!e.shiftKey && document.activeElement === last){
			e.preventDefault(); first.focus();
		}
	}

	// open/close handlers
	openBtn.addEventListener('click', function(){
		if(document.body.classList.contains('menu-open')) closeDrawer(); else openDrawer();
	});
	if(closeBtn) closeBtn.addEventListener('click', closeDrawer);
	if(backdrop) backdrop.addEventListener('click', closeDrawer);

	// close on resize to larger viewports
	function syncOnResize(){ if(!isSmallViewport() && document.body.classList.contains('menu-open')) closeDrawer(); }
	window.addEventListener('resize', syncOnResize);
	window.addEventListener('orientationchange', syncOnResize);

	// Swipe-to-close on drawer (touch)
	let startX = null; let startY = null;
	const threshold = 40; const restraint = 120;
	drawer.addEventListener('touchstart', function(e){ const t = e.changedTouches[0]; startX = t.pageX; startY = t.pageY; }, {passive:true});
	drawer.addEventListener('touchend', function(e){ if(startX === null) return; const t = e.changedTouches[0]; const distX = t.pageX - startX; const distY = Math.abs(t.pageY - startY); if(distX > threshold && distY < restraint){ closeDrawer(); } startX = null; startY = null; }, {passive:true});

    // Timer functionality for Central Daylight Time (CDT)
    function updateTimer() {
        const timerElement = document.getElementById('timer');
        if (!timerElement) return;

        // Get the current time in CDT
        const now = new Date();
        const options = { timeZone: 'America/Chicago', hour: '2-digit', minute: '2-digit', hour12: true };
        const timeString = new Intl.DateTimeFormat('en-US', options).format(now);

        // Update the timer element
        timerElement.textContent = timeString;
    }

    // Update the timer every second
    setInterval(updateTimer, 1000);
    updateTimer();

    // Weather functionality using NWS API
    const zipToLatLon = {
        '77002': { lat: 29.752552016514958, lon: -95.37041452085252 }, // Downtown Houston
		'77006': { lat: 29.743058828618043, lon: -95.38872535855693 }, // Midtown
        '77380': { lat: 30.156561330335677, lon: -95.49660348630132 }, // The Woodlands
        '77373': { lat: 30.060076989444728, lon: -95.38425991103118 }, // Spring
        '77339': { lat: 30.044222740754748, lon: -95.21623381365497 }, // Kingwood
        '77024': { lat: 29.785061559286614, lon: -95.55081109649475 }, // Memorial
        '77493': { lat: 29.86892877253447, lon: -95.83598143772524 }, // Katy
        '77584': { lat: 29.530560656795313, lon: -95.32129891012985 }, // Pearland
        '77478': { lat: 29.619364025666467, lon: -95.60777755914671 }, // Sugar Land
        '77502': { lat: 29.68279320790105, lon: -95.2012332550293 }, // Pasadena
        '77520': { lat: 29.729931184106412, lon: -94.98634034561468 }, // Baytown
        '77338': { lat: 29.936252806244546, lon: -95.22575025287787 }, // Humble
        '77550': { lat: 29.3056910729656, lon: -94.79363293237242 }, // Galveston
        '77571': { lat: 29.681951027430866, lon: -95.0504713333233 }, // La Porte
        '77301': { lat: 30.372421017538844, lon: -95.45451089868827 }, // Conroe
        '77375': { lat: 30.11186355029859, lon: -95.58409952099358 }, // Tomball
        '77429': { lat: 30.014649608810636, lon: -95.66645508653544 }, // Cypress
        '77459': { lat: 29.478751988175286, lon: -95.52957848248982 }, // Missouri City
        '77477': { lat: 29.622026902031646, lon: -95.56770250882548 }, // Stafford
        '77586': { lat: 29.583383471744852, lon: -95.0348656373267 }, // Seabrook
        '77573': { lat: 29.495046460629094, lon: -95.09075177952913 }, // League City
        '77336': { lat: 30.074194329781477, lon: -95.09146031763426 }, // Huffman
        '77346': { lat: 29.998823130908438, lon: -95.17521190149226 }, // Atascocita
        '77077': { lat: 29.748046372801, lon: -95.62195225406828 }, // Briarforest
        '77530': { lat: 29.79477265921269, lon: -95.1119367314215 }  // Channelview
    };

    async function fetchWeatherNWS(lat, lon) {
        const url = `https://api.weather.gov/points/${lat},${lon}`;
        try {
            // Fetch the forecast URL from the NWS API
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Failed to fetch weather for ${lat},${lon}: ${response.statusText}`);
            const data = await response.json();

			// Use the hourly forecast URL to get the actual weather data
			const hourlyForecastUrl = data.properties.forecastHourly;
			const hourlyResponse = await fetch(hourlyForecastUrl);
			if (!hourlyResponse.ok) throw new Error(`Failed to fetch hourly forecast: ${hourlyResponse.statusText}`);
			const hourlyData = await hourlyResponse.json();

			// Get the current hour's temperature and short forecast
			const now = new Date();
			const currentHour = hourlyData.properties.periods.find(period => {
				const startTime = new Date(period.startTime);
				const endTime = new Date(period.endTime);
				return now >= startTime && now <= endTime;
			});

			if (currentHour) {
				return { temperature: currentHour.temperature, shortForecast: currentHour.shortForecast };
			} else {
				throw new Error('No hourly forecast data available for the current time.');
			}
        } catch (error) {
            console.error(`Error fetching weather for ${lat},${lon}:`, error);
            return null;
        }
    }

    async function updateWeather() {
        for (const [zip, { lat, lon }] of Object.entries(zipToLatLon)) {
            const temp = await fetchWeatherNWS(lat, lon);
            const weatherElement = document.getElementById(zip);
			if (weatherElement && temp !== null) {
				const t = temp.temperature;
				const cond = temp.shortForecast || '';
				weatherElement.textContent = `${t}°F`;
				// apply temperature color class
				applyTempClass(weatherElement, t);
				// add icon
				applyWeatherIcon(weatherElement, cond);
			}
        }
    }

	function pickIconClassForCondition(cond){
		if(!cond) return 'fa-solid fa-sun';
		const c = cond.toLowerCase();
		if(c.includes('thunder') || c.includes('storm') || c.includes('tstm')) return 'fa-solid fa-bolt';
		if(c.includes('rain') || c.includes('showers')) return 'fa-solid fa-cloud-showers-heavy';
		if(c.includes('snow') || c.includes('sleet') || c.includes('flurr')) return 'fa-solid fa-snowflake';
		if(c.includes('tornado')) return 'fa-solid fa-tornado';
		if(c.includes('hurricane') || c.includes('tropical')) return 'fa-solid fa-hurricane';
		if(c.includes('cloud') || c.includes('overcast')) return 'fa-solid fa-cloud';
		if(c.includes('wind') || c.includes('breezy')) return 'fa-solid fa-wind';
		if(c.includes('sun') || c.includes('clear')) return 'fa-solid fa-sun';
		return 'fa-solid fa-sun';
	}

	function applyWeatherIcon(h2el, cond){
		if(!h2el) return;
		let icon = h2el.querySelector('i.weather-icon');
		if(!icon){
			icon = document.createElement('i');
			icon.className = 'weather-icon';
			icon.setAttribute('aria-hidden', 'true');
			icon.style.marginLeft = '8px';
			h2el.appendChild(icon);
		}
		const cls = pickIconClassForCondition(cond);
		icon.className = cls + ' weather-icon';
		icon.style.color = 'currentColor';
	}

	// helper: apply a temp-based class to the target h2 element
	function applyTempClass(el, temp){
		if(!el) return;
		// remove any existing temp- classes
		el.classList.remove('temp-90','temp-80','temp-70','temp-60','temp-50','temp-40','temp-30','temp-29');
		const t = Number(temp);
		if(Number.isNaN(t)) return;
		if(t >= 90) el.classList.add('temp-90');
		else if(t >= 80) el.classList.add('temp-80');
		else if(t >= 70) el.classList.add('temp-70');
		else if(t >= 60) el.classList.add('temp-60');
		else if(t >= 50) el.classList.add('temp-50');
		else if(t >= 40) el.classList.add('temp-40');
		else if(t >= 30) el.classList.add('temp-30');
		else el.classList.add('temp-29');
	}
    // Fetch and update weather data
    updateWeather();

})();

// Client-side posts rendering: fetch from serverless API and populate hero + story cards
(function(){
	const HERO_CHAR_LIMIT = 168; // hero paragraph truncate (changed per request)
	const STORY_CHAR_LIMIT = 140; // story-card paragraph truncate

	function truncate(str, n){
		if(!str) return '';
		return str.length > n ? str.slice(0,n).trim().replace(/\s+$/,'') + '…' : str;
	}

	function timeAgo(iso){
		if(!iso) return '';
		const then = new Date(iso);
		const now = new Date();
		const diffMs = now - then;
		const diffMins = Math.floor(diffMs / 60000);
		if(diffMins < 1) return 'just now';
		if(diffMins < 60) return `${diffMins}m ago`;
		const diffHours = Math.floor(diffMins / 60);
		return `${diffHours}h ago`;
	}

			// Pagination state
			let currentPage = 1;
			const perPage = 6; // 3x2 grid
			let totalItems = 0;

			function setPager(page, total){
				totalItems = typeof total === 'number' ? total : 0;
				const totalPages = Math.max(1, Math.ceil(totalItems / perPage));
				const left = document.querySelector('.page-indexer .arrow.left');
				const right = document.querySelector('.page-indexer .arrow.right');
				const pageNum = document.querySelector('.page-indexer .page-number');
				if(pageNum) pageNum.textContent = `Page ${page}`;
				if(left) left.disabled = page <= 1;
				if(right) right.disabled = page >= totalPages;
			}

			async function loadHero(){
				try{
					const r = await fetch('/api/posts?hero=1');
					if(!r.ok) throw new Error('hero fetch failed');
					const data = await r.json();
					const hero = data && data.post ? data.post : null;
										// Use standalone #hero-img for hero image and update nearby hero text nodes
										const heroImgEl = document.getElementById('hero-img');
										if(!heroImgEl){ console.warn('hero image element missing'); return; }
										if(!hero){
											heroImgEl.style.display = 'none';
											// optionally clear nearby title/date/body placeholders
											return;
										}
										// set image and show
										heroImgEl.src = hero.url || '';
										heroImgEl.alt = hero.title || '';
										heroImgEl.style.display = '';
										// set the page-level hero title/date/body in case index shows them
										const heroTitle = document.querySelector('.hero h1'); if(heroTitle) heroTitle.textContent = hero.title || '';
										const heroP = document.querySelector('.hero p'); if(heroP) heroP.textContent = truncate(hero.body || '', HERO_CHAR_LIMIT);
										const heroTime = document.querySelector('.hero h4'); if(heroTime) heroTime.textContent = timeAgo(hero.scrapedAt || null);
				}catch(err){ console.error('loadHero error', err); }
			}

			async function loadPage(page){
				try{
					const r = await fetch(`/api/posts?page=${page}&perPage=${perPage}`);
					if(!r.ok) throw new Error('page fetch failed');
					const data = await r.json();
					const posts = data.posts || [];
					const total = typeof data.total === 'number' ? data.total : 0;
					const listEl = document.querySelector('.recent-post-tier');
					if(!listEl) return;
					listEl.innerHTML = '';
					// render received posts
					for(const post of posts){
						const card = document.createElement('div'); card.className = 'story-card';
						const img = document.createElement('img'); img.src = post.url || ''; img.alt = post.title || '';
						const title = document.createElement('h1'); title.textContent = post.title || '';
						const body = document.createElement('p'); body.textContent = truncate(post.body || '', STORY_CHAR_LIMIT);
						card.appendChild(img); card.appendChild(title); card.appendChild(body);
						listEl.appendChild(card);
					}
					// add placeholders to keep 3x2 grid layout if fewer than perPage
					const received = posts.length;
					for(let i=0;i<perPage-received;i++){
						const ph = document.createElement('div'); ph.className = 'story-card placeholder'; ph.setAttribute('aria-hidden','true');
						ph.style.visibility = 'hidden'; ph.style.height = '1px'; listEl.appendChild(ph);
					}
					setPager(page, total);
				}catch(err){ console.error('loadPage error', err); }
			}

			// wire pager controls
			document.addEventListener('click', function(e){
				if(e.target.matches('.page-indexer .arrow.left')){
					if(currentPage>1){ currentPage--; loadPage(currentPage); }
					return;
				}
				if(e.target.matches('.page-indexer .arrow.right')){
					const totalPages = Math.max(1, Math.ceil(totalItems / perPage));
					if(currentPage < totalPages){ currentPage++; loadPage(currentPage); }
					return;
				}
			});

			async function loadPosts(){
				await loadHero();
				await loadPage(currentPage);
			}

	// Load posts on DOMContentLoaded
	if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', loadPosts); else loadPosts();
})();

</script>
<script>
// Final article loader: fetch post by title from querystring and populate the page (hero image, title, date, body)
(function(){
	function getTitleFromQS(){
		try{
			const params = new URLSearchParams(location.search);
			if(params.has('title')) return params.get('title') || '';
			const raw = location.search.replace(/^\?/,'');
			if(raw && !raw.includes('=')) return decodeURIComponent(raw).trim();
			return '';
		}catch(e){ return ''; }
	}

	function formatDate(iso){
		if(!iso) return '';
		const d = new Date(iso);
		return d.toLocaleString('en-US', { month: 'long', day: 'numeric', year: 'numeric', hour: 'numeric', minute: '2-digit', hour12: true });
	}

	function bodyToHtml(text){
		if(!text) return '';
		// split into paragraphs and insert injection slot divs between them
		const parts = text.split(/\n\n+/).map(p => `<p>${p.replace(/\n/g,'<br/>')}</p>`);
		// interleave injection placeholders (three slots max)
		const out = [];
		for(let i=0;i<parts.length;i++){
			out.push(parts[i]);
			if(i < 3){ out.push(`<div class="inject-slot" data-slot="inject-slot-${i+1}"></div>`); }
		}
		return out.join('\n');
	}

	async function load(){
			// Prefer title from querystring (legacy), but fall back to a slug in the pathname (/articles/:slug)
			let title = getTitleFromQS();
			let slugFromPath = '';
			if(!title){
				// detect /articles/:slug
				const m = location.pathname.match(/\/articles\/(.+)$/);
				if(m && m[1]) slugFromPath = decodeURIComponent(m[1]).replace(/\/+$/,'');
			}
			if(!title && !slugFromPath) return;
		try{
			// Fetch by title or slug depending on what's available
			const q = title ? `title=${encodeURIComponent(title)}` : `slug=${encodeURIComponent(slugFromPath)}`;
			const fetchUrl = `/api/posts?${q}`;
			const res = await fetch(fetchUrl);
			if(!res.ok){
				// log body where possible to help debug server errors (500)
				console.error('article fetch failed', fetchUrl, res.status, await res.text().catch(()=>'<no-body>'));
				return;
			}
			const json = await res.json();
			const post = json && json.post ? json.post : null;
			if(!post) return;
			// set hero image (use post.url or post.image). Prefer an existing #hero-img element
			try{
				const imgUrl = post.url || post.image || '';
				const heroEl = document.querySelector('.hero');
				const existingImg = document.getElementById('hero-img');
				if(existingImg){
					if(imgUrl){
						existingImg.src = imgUrl;
						existingImg.alt = post.title || '';
						existingImg.style.display = '';
					} else {
						// hide if no image available
						existingImg.removeAttribute('src');
						existingImg.style.display = 'none';
					}
				} else if(heroEl){
					// fallback: create an image element as before
					if(imgUrl){
						heroEl.innerHTML = '';
						const img = document.createElement('img');
						img.src = imgUrl;
						img.alt = post.title || '';
						img.loading = 'lazy';
						img.decoding = 'async';
						heroEl.appendChild(img);
					}
				}
			}catch(e){ console.warn('hero image set failed', e); }

			// Populate SEO/meta tags so shared links show useful preview
			try{
				const firstPara = (post.body||'').split(/\n\n+/)[0] || '';
				// set document title and meta tags for social previews
				const pageTitle = `Hourly Houston - ${post.title || ''}`.trim();
				// update <title> and the #page-title element for good measure
				try{ document.title = pageTitle; }catch(e){}
				const pageTitleEl = document.getElementById('page-title'); if(pageTitleEl) pageTitleEl.textContent = pageTitle;
				// standard description
				const desc = firstPara.replace(/\n/g,' ');
				const img = post.url || '';
				const title = post.title || 'Hourly Houston';
				document.getElementById('meta-desc').setAttribute('content', desc);
				// Open Graph
				document.getElementById('meta-ogtitle').setAttribute('content', title);
				document.getElementById('meta-ogdesc').setAttribute('content', desc);
				document.getElementById('meta-ogimage').setAttribute('content', img);
				document.getElementById('meta-ogurl').setAttribute('content', location.href);
				document.getElementById('meta-ogsite').setAttribute('content', 'Hourly Houston');
				// Twitter
				document.getElementById('meta-twitter-title').setAttribute('content', title);
				document.getElementById('meta-twitter-desc').setAttribute('content', desc);
				document.getElementById('meta-twitter-image').setAttribute('content', img);
				// fallback meta name=title
				document.getElementById('meta-name-title').setAttribute('content', pageTitle);
			}catch(e){/* ignore if DOM meta nodes missing */}

			// After inserting the article body, run any inject templates found in the head
			// Find .inject-slot placeholders and populate from matching <script type="text/x-inject" id="inject-slot-N">
			(function runInjects(){
				const slots = Array.from(document.querySelectorAll('.inject-slot'));
				slots.forEach(slot => {
					const id = slot.dataset.slot;
					if(!id) return;
					const tpl = document.getElementById(id);
					if(!tpl) return;
					const exec = tpl.getAttribute('data-exec') === 'true';
					const content = tpl.textContent || tpl.innerText || '';
					if(exec){
						const s = document.createElement('script');
						s.type = 'application/javascript';
						s.text = content;
						slot.appendChild(s);
					}else{
						// treat content as escaped HTML (user can include &lt;div&gt; markup in the template)
						slot.innerHTML = content;
					}
				});
			})();

			// Simplified hero handling: a single <img> is injected earlier; avoid mutation observers or extra event handlers.
			const t = document.getElementById('title'); if(t) t.textContent = post.title || '';
			const dt = document.getElementById('date'); if(dt) dt.textContent = formatDate(post.scrapedAt || null);
			const b = document.getElementById('body'); if(b) b.innerHTML = bodyToHtml(post.body || '');
		}catch(err){ console.error('article load error', err); }
	}

	if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', load); else load();
})();
</script>
</body>
</html>
